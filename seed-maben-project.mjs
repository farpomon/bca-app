import { drizzle } from "drizzle-orm/mysql2";
import mysql from "mysql2/promise";
import { projects, assessments } from "./drizzle/schema.ts";

const DATABASE_URL = process.env.DATABASE_URL;

if (!DATABASE_URL) {
  console.error("DATABASE_URL environment variable is not set");
  process.exit(1);
}

async function seed() {
  console.log("ðŸŒ± Seeding BÂ³NMA 1729 Comox Avenue project...");

  const connection = await mysql.createConnection(DATABASE_URL);
  const db = drizzle(connection);

  try {
    // Create project
    const [projectResult] = await db.insert(projects).values({
      userId: 1, // Owner user ID
      name: "1729 Comox Avenue - Community Library",
      address: "1729 Comox Ave, V9M 3M1, BC",
      clientName: "Town of Comox",
      propertyType: "Institutional/Commercial",
      constructionType: "Wood Framing",
      yearBuilt: 1973,
      numberOfUnits: 1,
      numberOfStories: 2,
      buildingCode: "BC Building Code 2024",
      status: "in_progress",
    });

    const projectId = projectResult.insertId;
    console.log(`âœ… Created project with ID: ${projectId}`);

    // Sample assessments from the report
    const assessmentsData = [
      {
        projectId,
        componentCode: "B10",
        componentName: "CMU Walls",
        uniformatLevel1: "B",
        uniformatLevel2: "B10",
        uniformatLevel3: "B1010",
        uniformatLevel4: null,
        condition: "excellent",
        observations: "The exterior walls consist of reinforced concrete masonry unit (CMU) block construction above the foundation. The wall assembly features ribbed CMU sections with horizontal, textured bands cast into the face of the blocks, and a painted finish that provides weather protection. The exterior walls appeared clean and well maintained, with no evidence of deterioration.",
        recommendations: "No notable cracks or uneven surfaces were observed that would indicate movement or distortion of these exterior walls. No capital expenditure is anticipated.",
        estimatedRepairCost: 0,
        replacementValue: 0,
        actionYear: null,
      },
      {
        projectId,
        componentCode: "B20",
        componentName: "FCB Walls",
        uniformatLevel1: "B",
        uniformatLevel2: "B20",
        uniformatLevel3: "B2010",
        uniformatLevel4: null,
        condition: "excellent",
        observations: "The exterior walls include Fibre Cement Board (FCB) panel assemblies installed over wood framing. Panels are mechanically fastened with joints sealed against water penetration. Exterior wall assemblies are performing as designed, with no deterioration noted during the review.",
        recommendations: "Renewal of the fibre cement board (FCB) siding system at the end of its estimated service life (ESL).",
        estimatedRepairCost: 86000,
        replacementValue: 120000,
        actionYear: 2039,
      },
      {
        projectId,
        componentCode: "B30",
        componentName: "Exterior Painting Walls",
        uniformatLevel1: "B",
        uniformatLevel2: "B30",
        uniformatLevel3: "B3010",
        uniformatLevel4: null,
        condition: "fair",
        observations: "The exterior walls are finished with a painted protective coating applied to both the concrete masonry unit (CMU) block walls and the fiber cement board (FCB) siding above. The paint provides weather resistance, unifies the facade visually, and highlights the horizontal ribbed CMU bands for architectural detail. The painted exterior walls are showing signs of fading and deterioration consistent with nearing the end of their estimated service life (ESL).",
        recommendations: "Repaint Exterior Walls finishes.",
        estimatedRepairCost: 12000,
        replacementValue: 18000,
        actionYear: 2029,
      },
      {
        projectId,
        componentCode: "B40",
        componentName: "Vinyl Frame Windows",
        uniformatLevel1: "B",
        uniformatLevel2: "B40",
        uniformatLevel3: "B4010",
        uniformatLevel4: null,
        condition: "excellent",
        observations: "The exterior windows consist of vinyl-framed units with insulating glass (IGU) double glazing. Frames are sealed to adjacent walls with perimeter caulking. The exterior vinyl-frame windows are showing signs of aging but still appear to be functioning adequately. Ensure proper maintenance of the window, including the perimeter sealant.",
        recommendations: "Renewal of vinyl-frame windows at the end of their estimated service life (ESL).",
        estimatedRepairCost: 48000,
        replacementValue: 65000,
        actionYear: 2044,
      },
      {
        projectId,
        componentCode: "B50",
        componentName: "Exterior Glazed Doors",
        uniformatLevel1: "B",
        uniformatLevel2: "B50",
        uniformatLevel3: "B5010",
        uniformatLevel4: null,
        condition: "fair",
        observations: "The exterior doors consist of painted metal utility doors, double entrance doors at the Lions Club, a glazed aluminum storefront system at the museum/gallery entrance, and secondary service and egress doors. The exterior glazed doors show typical wear with aging components. Functionality is adequate; however, the existing lockset at the main exit does not align with current egress standards.",
        recommendations: "The Lockset at the main exit door needs to be upgraded to an approved emergency device mechanism, including a panic/exit device, to comply with the BCBC exit door requirements.",
        estimatedRepairCost: 1500,
        replacementValue: 2500,
        actionYear: 2026,
      },
      {
        projectId,
        componentCode: "C10",
        componentName: "Drywall Stud Walls",
        uniformatLevel1: "C",
        uniformatLevel2: "C10",
        uniformatLevel3: "C1010",
        uniformatLevel4: null,
        condition: "good",
        observations: "Interior partition walls consist of painted gypsum wallboard (drywall) installed over wood or metal stud framing. Walls are finished with paint or wallpaper in various locations. Interior partitions appear to be in good condition overall, with typical wear consistent with the building's age and use.",
        recommendations: "Monitor and maintain interior partitions. Repair or replace damaged sections as needed during routine maintenance cycles.",
        estimatedRepairCost: 5000,
        replacementValue: 45000,
        actionYear: 2030,
      },
      {
        projectId,
        componentCode: "C20",
        componentName: "Interior Doors",
        uniformatLevel1: "C",
        uniformatLevel2: "C20",
        uniformatLevel3: "C2010",
        uniformatLevel4: null,
        condition: "good",
        observations: "Interior doors consist of painted hollow-core wood doors and solid-core wood doors at select locations. Hardware includes lever handles, hinges, and closers where required. Interior doors are functioning adequately with typical wear patterns. Some doors show minor surface damage and hardware wear consistent with age and use.",
        recommendations: "Continue routine maintenance and hardware adjustments. Replace doors showing excessive wear or damage as part of ongoing facility maintenance.",
        estimatedRepairCost: 3000,
        replacementValue: 25000,
        actionYear: 2032,
      },
      {
        projectId,
        componentCode: "C30",
        componentName: "Washroom Accessories",
        uniformatLevel1: "C",
        uniformatLevel2: "C30",
        uniformatLevel3: "C3020",
        uniformatLevel4: null,
        condition: "fair",
        observations: "Washroom accessories include toilet paper holders, paper towel dispensers, soap dispensers, mirrors, grab bars, and waste receptacles. Accessories show typical wear and some units are outdated or showing signs of deterioration.",
        recommendations: "Replace aging washroom accessories with modern, durable units that meet current accessibility standards.",
        estimatedRepairCost: 8000,
        replacementValue: 12000,
        actionYear: 2028,
      },
      {
        projectId,
        componentCode: "C40",
        componentName: "Millwork - Cabinets",
        uniformatLevel1: "C",
        uniformatLevel2: "C40",
        uniformatLevel3: "C4010",
        uniformatLevel4: null,
        condition: "good",
        observations: "Interior millwork includes wood and laminate cabinets, countertops, shelving, and built-in furniture throughout the facility. Millwork is generally in good condition with typical wear from daily use. Some laminate surfaces show edge wear and minor damage.",
        recommendations: "Continue routine maintenance and repairs. Replace heavily worn or damaged millwork components as needed.",
        estimatedRepairCost: 10000,
        replacementValue: 55000,
        actionYear: 2033,
      },
      {
        projectId,
        componentCode: "C50",
        componentName: "Interior Stairs",
        uniformatLevel1: "C",
        uniformatLevel2: "C50",
        uniformatLevel3: "C5010",
        uniformatLevel4: null,
        condition: "excellent",
        observations: "Interior stairs consist of wood-framed construction with painted or carpeted treads and risers. Handrails are installed on both sides meeting code requirements. Stairs are in excellent condition with no significant wear or safety concerns noted.",
        recommendations: "Continue routine maintenance including tread surface renewal and handrail inspections.",
        estimatedRepairCost: 0,
        replacementValue: 18000,
        actionYear: null,
      },
      {
        projectId,
        componentCode: "D10",
        componentName: "Domestic Water Distribution",
        uniformatLevel1: "D",
        uniformatLevel2: "D10",
        uniformatLevel3: "D1010",
        uniformatLevel4: null,
        condition: "good",
        observations: "The domestic water distribution system consists of copper piping throughout the building. The system appeared to be functioning adequately with no visible leaks or significant issues noted during the visual review.",
        recommendations: "Continue monitoring the system. Consider pipe replacement at end of service life or if leaks develop.",
        estimatedRepairCost: 8000,
        replacementValue: 45000,
        actionYear: 2035,
      },
      {
        projectId,
        componentCode: "D20",
        componentName: "Washroom Fixtures",
        uniformatLevel1: "D",
        uniformatLevel2: "D20",
        uniformatLevel3: "D2020",
        uniformatLevel4: null,
        condition: "fair",
        observations: "Washroom fixtures include toilets, urinals, sinks, and faucets. Fixtures show age-related wear and some units are outdated. Some fixtures do not meet current water efficiency standards.",
        recommendations: "Replace aging washroom fixtures with modern, water-efficient units that meet current plumbing codes and accessibility standards.",
        estimatedRepairCost: 15000,
        replacementValue: 28000,
        actionYear: 2030,
      },
      {
        projectId,
        componentCode: "D30",
        componentName: "Domestic Hot Water",
        uniformatLevel1: "D",
        uniformatLevel2: "D30",
        uniformatLevel3: "D3010",
        uniformatLevel4: null,
        condition: "good",
        observations: "The domestic hot water system consists of electric water heaters serving the facility. Units appeared to be functioning adequately with no issues noted during the review.",
        recommendations: "Monitor performance and replace water heaters at end of service life (typically 12-15 years).",
        estimatedRepairCost: 6000,
        replacementValue: 12000,
        actionYear: 2032,
      },
      {
        projectId,
        componentCode: "D40",
        componentName: "Drainage System",
        uniformatLevel1: "D",
        uniformatLevel2: "D40",
        uniformatLevel3: "D4010",
        uniformatLevel4: null,
        condition: "good",
        observations: "The drainage system consists of cast iron and PVC piping. The system appeared to be functioning adequately with no visible issues during the visual review.",
        recommendations: "Continue routine maintenance and monitoring. Address any blockages or leaks promptly.",
        estimatedRepairCost: 9000,
        replacementValue: 38000,
        actionYear: 2036,
      },
      {
        projectId,
        componentCode: "D50",
        componentName: "Electric Baseboard Heater",
        uniformatLevel1: "D",
        uniformatLevel2: "D50",
        uniformatLevel3: "D5010",
        uniformatLevel4: null,
        condition: "fair",
        observations: "Electric baseboard heaters provide space heating throughout the facility. Units show age-related wear and some are operating inefficiently.",
        recommendations: "Replace aging electric baseboard heaters with modern, energy-efficient units or consider upgrading to a more efficient heating system.",
        estimatedRepairCost: 12000,
        replacementValue: 22000,
        actionYear: 2029,
      },
      {
        projectId,
        componentCode: "D60",
        componentName: "Roof Top Unit",
        uniformatLevel1: "D",
        uniformatLevel2: "D60",
        uniformatLevel3: "D6010",
        uniformatLevel4: null,
        condition: "good",
        observations: "Rooftop HVAC units provide heating, ventilation, and air conditioning for specific zones. Units appeared to be functioning adequately with routine maintenance being performed.",
        recommendations: "Continue routine maintenance and monitoring. Replace units at end of service life (typically 15-20 years).",
        estimatedRepairCost: 18000,
        replacementValue: 45000,
        actionYear: 2034,
      },
      {
        projectId,
        componentCode: "D70",
        componentName: "Fire Protection - Extinguishers",
        uniformatLevel1: "D",
        uniformatLevel2: "D70",
        uniformatLevel3: "D7010",
        uniformatLevel4: null,
        condition: "excellent",
        observations: "Portable fire extinguishers are installed throughout the facility in compliance with fire code requirements. Units are properly mounted, tagged, and inspected regularly.",
        recommendations: "Continue annual inspections and maintenance as required by fire code.",
        estimatedRepairCost: 0,
        replacementValue: 3000,
        actionYear: null,
      },
      {
        projectId,
        componentCode: "D80",
        componentName: "Fire Alarm Control Panel",
        uniformatLevel1: "D",
        uniformatLevel2: "D80",
        uniformatLevel3: "D8010",
        uniformatLevel4: null,
        condition: "good",
        observations: "The fire alarm system includes a control panel, smoke detectors, heat detectors, manual pull stations, and audible/visual notification devices. The system appeared to be functioning properly and is inspected annually.",
        recommendations: "Continue annual inspections and testing. Replace system components at end of service life or as required by code updates.",
        estimatedRepairCost: 8000,
        replacementValue: 25000,
        actionYear: 2033,
      },
      {
        projectId,
        componentCode: "D90",
        componentName: "Electrical Service & Distribution",
        uniformatLevel1: "D",
        uniformatLevel2: "D90",
        uniformatLevel3: "D9010",
        uniformatLevel4: null,
        condition: "good",
        observations: "The electrical service and distribution system includes main service entrance, distribution panels, and branch circuit wiring. The system appeared to be functioning adequately with no immediate concerns noted.",
        recommendations: "Continue routine maintenance and monitoring. Upgrade capacity if additional electrical loads are added.",
        estimatedRepairCost: 10000,
        replacementValue: 55000,
        actionYear: 2035,
      },
      {
        projectId,
        componentCode: "D91",
        componentName: "Interior Lighting",
        uniformatLevel1: "D",
        uniformatLevel2: "D91",
        uniformatLevel3: "D9110",
        uniformatLevel4: null,
        condition: "fair",
        observations: "Interior lighting consists of a mix of fluorescent, LED, and incandescent fixtures. Many fixtures are outdated and inefficient. Some areas have inadequate lighting levels.",
        recommendations: "Upgrade to energy-efficient LED lighting throughout the facility to improve lighting quality and reduce energy costs.",
        estimatedRepairCost: 18000,
        replacementValue: 35000,
        actionYear: 2028,
      },
      {
        projectId,
        componentCode: "D92",
        componentName: "Exterior Lighting",
        uniformatLevel1: "D",
        uniformatLevel2: "D92",
        uniformatLevel3: "D9210",
        uniformatLevel4: null,
        condition: "fair",
        observations: "Exterior lighting includes wall-mounted fixtures, pole-mounted area lights, and entrance lighting. Some fixtures are outdated and several are not functioning properly.",
        recommendations: "Replace aging exterior lighting fixtures with modern, energy-efficient LED units. Ensure adequate illumination for safety and security.",
        estimatedRepairCost: 8000,
        replacementValue: 15000,
        actionYear: 2027,
      },
      {
        projectId,
        componentCode: "G10",
        componentName: "Walkways",
        uniformatLevel1: "G",
        uniformatLevel2: "G10",
        uniformatLevel3: "G1010",
        uniformatLevel4: null,
        condition: "fair",
        observations: "Exterior walkways consist of concrete and asphalt paving. Some sections show cracking, settlement, and surface deterioration. Trip hazards are present in some locations.",
        recommendations: "Repair or replace deteriorated walkway sections to eliminate trip hazards and improve accessibility.",
        estimatedRepairCost: 12000,
        replacementValue: 28000,
        actionYear: 2027,
      },
      {
        projectId,
        componentCode: "G20",
        componentName: "Accessibility Ramps",
        uniformatLevel1: "G",
        uniformatLevel2: "G20",
        uniformatLevel3: "G2010",
        uniformatLevel4: null,
        condition: "good",
        observations: "Accessibility ramps provide barrier-free access to building entrances. Ramps meet current code requirements for slope, width, and handrails. Surfaces show some wear but are generally in good condition.",
        recommendations: "Continue routine maintenance. Ensure handrails remain secure and ramp surfaces remain slip-resistant.",
        estimatedRepairCost: 3000,
        replacementValue: 15000,
        actionYear: 2031,
      },
      {
        projectId,
        componentCode: "G30",
        componentName: "Bike Racks",
        uniformatLevel1: "G",
        uniformatLevel2: "G30",
        uniformatLevel3: "G3010",
        uniformatLevel4: null,
        condition: "excellent",
        observations: "Bike racks are installed near building entrances to encourage cycling. Racks are in excellent condition and adequately sized for current demand.",
        recommendations: "Continue routine maintenance. Consider adding capacity if demand increases.",
        estimatedRepairCost: 0,
        replacementValue: 2000,
        actionYear: null,
      },
      {
        projectId,
        componentCode: "G40",
        componentName: "Soft Landscaping",
        uniformatLevel1: "G",
        uniformatLevel2: "G40",
        uniformatLevel3: "G4010",
        uniformatLevel4: null,
        condition: "good",
        observations: "Landscaping includes grass areas, planted beds, shrubs, and trees. Landscaping is generally well-maintained with routine mowing, trimming, and seasonal care. Some plant material shows age-related decline.",
        recommendations: "Continue routine landscape maintenance. Replace declining plant material and refresh planting beds as needed.",
        estimatedRepairCost: 7000,
        replacementValue: 18000,
        actionYear: 2030,
      },
    ];

    console.log(`ðŸ“ Inserting ${assessmentsData.length} assessments...`);
    
    for (const assessment of assessmentsData) {
      await db.insert(assessments).values(assessment);
    }

    console.log("âœ… All assessments inserted successfully!");
    console.log("\nðŸ“Š Summary:");
    console.log(`   Project: ${projectId} - 1729 Comox Avenue`);
    console.log(`   Assessments: ${assessmentsData.length} components`);
    console.log(`   Total Repair Cost: $${assessmentsData.reduce((sum, a) => sum + (a.estimatedRepairCost || 0), 0).toLocaleString()}`);
    console.log(`   Total Replacement Value: $${assessmentsData.reduce((sum, a) => sum + (a.replacementValue || 0), 0).toLocaleString()}`);
    
  } catch (error) {
    console.error("âŒ Error seeding database:", error);
    throw error;
  } finally {
    await connection.end();
  }
}

seed()
  .then(() => {
    console.log("\nðŸŽ‰ Seeding completed successfully!");
    process.exit(0);
  })
  .catch((error) => {
    console.error("\nðŸ’¥ Seeding failed:", error);
    process.exit(1);
  });
